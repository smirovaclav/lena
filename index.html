<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Generátor faktur (Inline A4)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#111; --muted:#6b7280; --border:#e5e7eb; --accent:#0b5cab; --bg:#f7fafc;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  font:14px/1.45 Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
}
.wrap{
  max-width: 230mm;
  margin: 16px auto;
  padding: 0 10px;
}
.sheet{
  width:210mm;
  min-height:297mm;
  margin:0 auto;
  padding:20mm;
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow:0 0 5px rgba(0,0,0,0.1);
  font-size:14px;
  overflow:auto;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:16px;
}
.logo-slot{
  width:160px; height:80px;
  border:2px dashed #cbd5e1;
  border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  overflow:hidden;
}
.logo-slot img{
  max-width:100%; max-height:100%; object-fit:contain;
}
.brand h1{margin:0;font-size:22px;}
.badge{display:inline-block;background:rgba(11,92,171,.08);color:var(--accent);padding:6px 10px;border-radius:8px;font-weight:600;font-size:12px;}
.meta{font-size:12px;color:var(--muted);margin-top:8px;}
.items{display:grid;gap:8px;margin:16px 0;}
.row-item{display:grid;grid-template-columns:1fr 80px 100px 100px;gap:8px;padding:8px;border:1px solid var(--border);border-radius:8px;}
.row-item div{font-size:14px;}
.total-box{display:flex;justify-content:flex-end;margin:12px 0;}
.total-card{min-width:200px;border:2px solid var(--border);border-radius:12px;padding:8px;background:#fff;}
.total-card .label{font-size:12px;color:var(--muted);}
.total-card .value{font-size:18px;font-weight:700;}
footer{display:flex;justify-content:space-between;margin-top:24px;font-size:12px;color:var(--muted);}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer;margin-top:10px;}
.qrimg{margin-top:6px;max-width:160px;display:inline-block;}
</style>
</head>
<body>
<div class="wrap">
  <div id="invoice" class="sheet" contenteditable="true">
    <header>
      <div>
        <div class="logo-slot" id="logoSlot"><span>Logo</span></div>
        <div class="brand">
          <h1 contenteditable="true">Faktura č. 2025-001</h1>
          <span class="badge">Neplátce DPH</span>
        </div>
        <div class="meta">
          <div>Datum vystavení: <strong contenteditable="true">12.10.2025</strong></div>
          <div>Datum splatnosti: <strong contenteditable="true">26.10.2025</strong></div>
        </div>
      </div>
      <div id="qrWrap" style="text-align:right">
        <img id="qrImg" class="qrimg" alt="QR Platba" />
      </div>
    </header>

    <section style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
      <div>
        <h3>Vystavitel</h3>
        <p contenteditable="true"><strong>Jan Dvořák</strong><br>Křižíkova 12, 186 00 Praha 8<br>IČ: 12345678<br>DIČ: CZ12345678</p>
      </div>
      <div>
        <h3>Příjemce</h3>
        <p contenteditable="true"><strong>Alfa Beta, s.r.o.</strong><br>Jungmannova 26/15, 110 00 Praha 1<br>IČ: 87654321<br>DIČ: CZ87654321</p>
      </div>
    </section>

    <section class="items" id="itemsPreview">
      <div class="row-item" contenteditable="true">
        <div>Datová analýza – konzultace</div>
        <div>4</div>
        <div>850 Kč</div>
        <div>3400 Kč</div>
      </div>
      <div class="row-item" contenteditable="true">
        <div>Zpracování reportu</div>
        <div>2</div>
        <div>925 Kč</div>
        <div>1850 Kč</div>
      </div>
    </section>

    <div class="total-box">
      <div class="total-card">
        <div class="label">Cena celkem k úhradě</div>
        <div class="value" id="grandTotal">5250 Kč</div>
      </div>
    </div>

    <section>
      <h3>Platební údaje</h3>
      <p contenteditable="true" id="payBlock">
        Bankovní účet: <strong>222785210/0600</strong><br>
        Variabilní symbol: <strong>2025001</strong><br>
        Způsob úhrady: bankovní převod
      </p>
    </section>

    <footer>
      <div contenteditable="true">Telefon: +420 777 123 456</div>
      <div contenteditable="true">Email: jan.dvorak@example.com</div>
    </footer>
  </div>

  <div style="text-align:center;">
    <button class="btn" id="makePdf">Vygenerovat PDF</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script>
async function buildQR(total){
  const accN = '222785210';
  const bank = '0600';
  const vs = '2025001';
  const currency = 'CZK';
  const msg = 'Faktura';
  const url = `https://api.paylibo.com/paylibo/generator/czech/image?accountNumber=${accN}&bankCode=${bank}&amount=${total.toFixed(2)}&currency=${currency}&vs=${vs}&message=${msg}`;
  try{
    const res = await fetch(url,{mode:'cors'});
    const blob = await res.blob();
    const reader = new FileReader();
    const dataUrl = await new Promise(ok=>{reader.onload=()=>ok(reader.result);reader.readAsDataURL(blob)});
    document.getElementById('qrImg').src = dataUrl;
  }catch(err){
    document.getElementById('qrImg').src = url;
  }
}

document.getElementById('makePdf').addEventListener('click', async()=>{
  const invoice = document.getElementById('invoice');
  // spočítat celkovou cenu
  let total=0;
  document.querySelectorAll('.row-item').forEach(row=>{
    const qty = parseFloat(row.children[1].textContent.replace(/\D/g,'')||0);
    const unit = parseFloat(row.children[2].textContent.replace(/\D/g,'')||0);
    const subtotal = qty*unit;
    row.children[3].textContent = subtotal.toLocaleString('cs-CZ',{style:'currency',currency:'CZK'});
    total += subtotal;
  });
  document.getElementById('grandTotal').textContent = total.toLocaleString('cs-CZ',{style:'currency',currency:'CZK'});
  await buildQR(total);
  html2pdf().set({
    margin:[10,10],
    filename:'faktura.pdf',
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2,useCORS:true},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  }).from(invoice).save();
});
</script>
</body>
</html>
